---
title: "ECR-721"
tags: ["Solidity", "Payment", "App"]
---

# Description

ECR 721 Interface:

```sol
// SPDX-License-Identifier: MIT
pragma solidity 0.8.26;

interface IERC165 {
    function supportsInterface(bytes4 interfaceID) external view returns (bool);
}

interface IERC721 is IERC165 {
    function balanceOf(address owner) external view returns (uint256 balance);
    function ownerOf(uint256 tokenId) external view returns (address owner);
    function safeTransferFrom(address from, address to, uint256 tokenId) external;
    function safeTransferFrom(
        address from,
        address to,
        uint256 tokenId,
        bytes calldata data
    ) external;
    function transferFrom(address from, address to, uint256 tokenId) external;
    function approve(address to, uint256 tokenId) external;
    function getApproved(uint256 tokenId) external view returns (address operator);
    function setApprovalForAll(address operator, bool _approved) external;
    function isApprovedForAll(
        address owner,
        address operator
    ) external view returns (bool);
}

interface IERC721Receiver {
    function onERC721Received(
        address operator,
        address from,
        uint256 tokenId,
        bytes calldata data
    ) external returns (bytes4);
}
```

---

# Tasks

## 1

Complete the function ownerOf

- function ownerOf(uint256 id) external view returns (address) {}
- Return the owner of id stored in _ownerOf
- Fail if token does not exist (_ownerOf[id] is zero address)

## 2

Complete the function balanceOf


`function balanceOf(address owner) external view returns (uint256) {}`

- Return the balance of owner stored in _balanceOf
- Fail if owner is zero address

## 3

Complete the function mint

This function is not part of ERC721 but it will be used for later tests.

```
function mint(address dst, uint256 id) external {
    // code
}
```

- Create new token having token id equal to id, owner set to dst
- dst cannot be zero address
- token must not exist yet
- Emit Transfer from zero address, to dst with token id id

## 4

Complete the function setApprovalForAll

```
function setApprovalForAll(address operator, bool approved) external {
    // code
}
```
This function enable or disable approval for a third party ("operator") to manage all of msg.sender's tokens

- set isApprovedForAll from msg.sender to operator to approved
- Emit ApprovalForAll

## 5

Complete the function getApproved

```
function getApproved(uint256 id) external view returns (address) {}
```

- Returns the address allowed to transfer id
- Fails if token does not exist

## 6

Complete the function approve

```
function approve(address spender, uint256 id) external {
    // code
}
```

This function approves spender to transfer token id on behalf of the owner

Set _approvals for id to spender
Emit Approval
Fail if msg.sender is not owner or if owner has not approved msg.sender as an operator

## 7

Complete the function transferFrom

```
function transferFrom(
    address src,
    address dst,
    uint256 id
) public {
    // code
}
```

- Transfer id from src to dst
- Reset _approvals for id
- Emit Transfer
- Fail if token does not exist
- Fail if src is not owner of id
- Fail if dst is zero address
- Fail if msg.sender is not owner or if owner has not approved msg.sender

## 8

Complete the function safeTransferFrom

```
function safeTransferFrom(
    address src,
    address to,
    uint256 id
) external  {
    // code
}
```

This function is same as transferFrom except it will call the function onERC721Received if dst is a contract

Here is the interface for IERC721Receiver

```
interface IERC721Receiver {
    function onERC721Received(
        address operator,
        address src,
        uint256 id,
        bytes calldata data
    ) external returns (bytes4);
}
```

- Transfers id from src to dst
- Reset _approvals for id
- Emit Transfer
- If dst is a contract call onERC721REceived, passing empty bytes ("") for data
- If dst is a contract check that onERC721Received returns IERC721Receiver.onERC721Received.selector
- Fail if token does not exist
- Fail if src is not owner of id
- Fail if dst is zero address
- Fail if msg.sender is not owner or if owner has not approved msg.sender

## 9

Complete the function safeTransferFrom

```
function safeTransferFrom(
    address src,
    address dst,
    uint256 id,
    bytes calldata data
) external {
    // code
}
```

This function is same as safeTransferFrom(address src, address dst, uint256 id) except it will call the function onERC721Received with data.

This function should

- Transfers id from src to dst
- Reset _approvals for id
- Emit Transfer
- If dst is a contract call onERC721REceived with data
- If dst is a contract check that onERC721Received returns IERC721Receiver.onERC721Received.selector
- Fail if token does not exist
- Fail if src is not owner of id
- Fail if dst is zero address
- Fail if msg.sender is not owner or if owner has not approved msg.sender

## 10

Complete the function burn

```
function burn(uint256 id) external {
    // code
}
```

This function is not part of ERC721.

- Delete token with id
- Clear all approvals
- Emit Transfer to zero address
- Fail if token does not exist
- Fail if msg.sender is not the owner of id

---

# Solution


